I"&<p>本文的目的在於介紹 Balancer 的 bonding surface，可以用來實現自動指數基金，1不需要雇用 fund manager 負責 portfolio rebalance。</p>

<p>本文思路是：先思考 Uniswap，回顧 Uniswap 的起源和思路，最後探討 Balancer bonding surface 的原理。</p>

<p>從理論，到實務，再到獲取早期用戶的信任，一小口一小口地，去中心化金融正在侵蝕傳統金融板塊。</p>

<h3 id="uniswap-的起源">Uniswap 的起源</h3>
<p>以第一性原理來思考：在以太坊上建立交易所，會遇到什麼問題？</p>

<p>我們得先回答：什麼是交易所？</p>

<p>傳統交易所的模式是，給交易者上來掛買單(bid) 和賣單(ask)，交易所依照其所遵循的各種原則實作並運行「交易撮合演算法」，撮合買家掛的買單和賣家掛的賣單。</p>

<p>在流動性高，也就是很多人交易、很多錢換手的交易所裡，任何時候都有非常高頻次且大量的掛單和撤單，因為在這個程式化交易的時代，交易程式們會剖析掛單簿 (order book) 和委託單流量 (order flow)，輔以交易演算法進行自動交易。掛單頻率以做市商 (market maker) 的交易程式為最，左手掛賣單和買家成交，右手掛買單和賣家成交。</p>

<p>做市商的盈利模式就是在左手賣右手買之間，賺取買賣價差 (bid-ask spread)。做市商的有效運行，能使交易所維持高流動性、買賣價差較小。所以做市商又名流動性提供者。</p>

<p>在以太坊上建立這樣交易撮合式的交易所，問題就在於以太坊上的交易 — 只要是在以太坊虛擬機上執行操作 — 都要付 gas。在不考慮擴容方案 (例如狀態通道) 的前提下，掛單和撤單都會消耗 gas。這讓做市的操作非常昂貴，導致缺乏做市商的存在，使早期去中心化交易所上的買賣價差都十分大，並且小小的交易量就會推動價格有感變化。</p>

<p>那麼，能不能想出一種不進行買賣撮合的交易所模式，適合在以太坊上運行？</p>

<h3 id="uniswap-的作法以及所謂-bonding-curve">Uniswap 的作法，以及所謂 bonding curve</h3>
<p>歡迎 Uniswap 登場。Uniswap 是以太坊上的一個自動做市合約。在 Uniswap 的世界裡，沒有掛單簿，也沒有撮合算法。</p>

<p>再從第一性原理來思考：做市商的目標是什麼？</p>

<p>舉個例子(<a href="https://blog.gnosis.pm/building-a-decentralized-exchange-in-ethereum-eea4e7452d6e">source</a>)，今天你想要在冰淇淋市場上當一名自動做市商。你左手賣冰淇淋買進美分(penny)，右手賣美分買進冰淇淋。作為一名想要永續經營的做市商，你的動機非常簡單：手上隨時有足夠的冰淇淋和美分來應付任何可能發生的市場狀況。什麼狀況呢？往極端想：一，如果今天天氣爆炸熱，一堆人跑來找你買冰淇淋，導致你的冰淇淋存貨下降；二，今天天氣爆炸冷，一堆人跑來找你賣對他們已毫無吸引力的冰淇淋換成美分，導致你的美分存貨下降。只要你的冰淇淋存貨或是美分存貨降到零，你就得被迫停止做市，去其他市場上補貨。想當自動做市商的你最討厭這種麻煩的情形了。</p>

<p>因此，必須存在某種機制讓你的存貨不會無止盡下降。比較粗暴的做法是，當某存貨降到一定水準以下，你就暫停該方向的交易。例如冰淇淋只剩20%存貨時你就不賣冰淇淋了，直到天氣轉冷，有人找你賣冰淇淋為止。比較優雅、連續的作法是，你左手掛出的冰淇淋賣價隨著你的存貨水準動態調整，存貨越少，賣價越貴。如果你手上只剩趨近於0的冰淇淋，則理論上你掛出的冰淇淋賣價應該要趨近於無窮大，保證勸退所有嘴饞的人。這樣做，讓你理論上不可能耗盡任何一種存貨，對吧？</p>

<p>好，那這個動態調整的價格如何實現？一個簡單的做法就是：左手掛出的冰淇淋賣價 = 美分存貨÷冰淇淋存貨。只要你還有足夠的美分存貨，則趨近於0的冰淇淋存貨將導致賣價飆升到天文數字。右手則是冰淇淋買價 = 冰淇淋存貨÷美分存貨。</p>

<p>下式描述冰淇淋賣價，<em>p</em> 是價格，<em>q</em> 是存貨，<em>P</em> 是美分，<em>I</em> 是冰淇淋：</p>

<p><img src="https://miro.medium.com/max/236/0*u50ZBfjpFoKhOZ6i." alt="price" /></p>

<p>這個賣價的意思是，如果在現有存貨的狀態下，有人向你購買無窮小份的冰淇淋，就該用這個價格跟他交易。</p>

<p>往源頭走，我們想起雙曲線 xy=k 上的任一點斜率都是 -y/x。而在冰淇淋存貨對美分存貨作圖，函數的斜率正是交易價格的意思 – 兩存貨微幅變動的比值不就是價格嗎！因此上述的數學關係其實可以從一個恆定式推導而出：</p>

<p><img src="https://miro.medium.com/max/166/0*t9HbjeRDmJx7PDii." alt="invariant" /></p>

<p>上式表示，任何時候你手上的冰淇淋存貨乘以美分存貨都是某定值(invariant)。你常聽到的 <em>bonding curve</em> 就是在描述上述這條雙曲線。它打破了傳統觀念裡，市場價格必定由買賣雙方一起決定的說法。在上述模型裡，價格在任何時候都依照賣方存貨比值而定。</p>

<p>舉例：今天有個買家跟你說，他要買50美分(下式中的 <em>p</em>)的冰淇淋，請問能買到多少冰淇淋呢(下式中的 <em>i</em>)？你看了看你當初開始營運時的起始存貨：100份冰淇淋與100美分。使用下式計算：</p>

<p><img src="https://miro.medium.com/max/356/0*_r3VRbp1J74WNggV." alt="calculate" /></p>

<p>你就能算出這個買家的50美分能換得多少冰淇淋了：</p>

<p><img src="https://miro.medium.com/max/678/0*n7yu_WDUXdAAp0KO." alt="result" /></p>

<p>這一對存貨(冰淇淋和美分)的總和就是所謂的流動池(liquidity pool)。任何一種 ERC-20 代幣和 Eth 兌換的流動池都能在 Uniswap 上找到。你也可以在Uniswap上為自己發佈的ERC-20代幣創建一個流動池。</p>

<h3 id="balancer-的-bonding-surface">Balancer 的 bonding surface</h3>

<p>Balancer 想做的事，就是把上述原理概括到「雜貨市場」的情形。假如今天，你想同時在冰淇淋、檸檬汁、香菸和口香糖市場裡當做市商，能否設計一種機制，讓你手上含美分在內的所有存貨都不可能歸零？</p>

<p>Balancer 辦到了。如果定義以下價值函數：</p>

<p>就能算出現貨價格：</p>

<p>###</p>

<p>Balancer 的 bonding surface 實現兩種目的：</p>
<ol>
  <li>自動再平衡的投資組合 — 不收取管理費的自動指數基金</li>
  <li>價格信號提供者</li>
</ol>

<p>指數基金的目標很簡單：維持各部位之間相對價值恆定。</p>

<p>一個地址想要保持 A 幣與 B 幣價值 7:3 的權重，同時地址再平衡前後總價值不變。
時刻一：50x A 幣價 $100，100x B 幣價 $50。兩幣總價值 1:1。
時刻二：A 幣幣價下跌至 $80，B 幣幣價下跌至 $30。
=&gt; 50x80 = 4000；100x30 = 3000，基金總價值 7000，若 1:1 則兩幣應分別價值 $3500。
時刻二+：再平衡交易發生。
=&gt; A 幣從 50 顆變成 43.75 顆。6.25 顆 A 幣價值 $500 變賣成 16.66667 顆 B 幣。
=&gt; 基金持有：43.75x A、116.667x B。兩幣價值皆為 $3500。</p>

<p>關鍵在於：再平衡的交易 (將 6.25A 交易成 16.6667B) 由誰完成？
• 截至目前為止：基金管理人，收取管理費，進行交易、記帳、稅務管理等。
• Balancer：外部游擊交易者來完成交易，獲得套利收益。</p>

<p>為什麼會有套利機會？
因為任何人在任何時候都能和基金買賣。
基金向外公布的 A-B 交易對匯率是 BalanceA/weightA / BalanceB/weightB。
在時刻一 時，基金 A-B 匯率是 50/1 / 100/1 = 1:2，等同基金外的 A-B 匯率。
在時刻二時，基金 A-B 匯率依舊是 1:2，但外界 A-B 匯率已變成 1:2.6667，
導致套利機會的出現，使外部任何交易者有誘因與基金交易，藉此獲利。
以 B 計價，基金收 2B 給 A，但外界已經是收 2.6667B 給 A。等於是基金的 A 比較便宜。
=&gt; 交易者提供 B 換取基金的便宜的 A，並導致基金 A 變少，B 變多，A對B匯率上升。
=&gt; 直到基金內 A 與 B 的數量變化至基金的 A-B 匯率與外界相同，套利機會消失，同時再平衡也完成了。</p>

<p>我的想法：
• Balancer 完成的是：以合約實現激勵機制，讓一個地址的各幣價值比自動維持恆定。
• 如果今天這個地址代表一家公司，A 與 B 的股份占比 1:1。這個地址持有的並非「A 與 B 投入相同數量的某法幣」，而是持有特定數量的 A token 和 B token，總價值等於公司價值。
• 這樣的情形導致，若股東的個人經濟價值下跌，公司價值跟著下跌。
• 若股東的個人經濟價值上升，則公司價值跟著上升。
• 這已經不是公司的概念了。公司的價值不應與股東個人經濟價值直接有關，而是與公司本身盈利能力有關。今天股東A自己另做生意賺錢了，導致A token 價值上升，這個生意與公司無關，在現有股份系統的設計之下，公司價值不應該跟著上升。
• 如果這個地址是一個國家呢？
• 國家持有所有國民的通證。
• 任何國民的經濟價值上升，都會自動反應在國家價值提升。
• 任何國民的經濟價值下滑，都會自動反應在國家價值下滑。
• 各國民通證在國家持有裡的權重是否為 1:1:1:1….:1?
◦ 亦即國家平等重視所有國民的經濟條件？
◦ 因為國家價值對任何國民經濟價值變動的敏感度相同？</p>
:ET